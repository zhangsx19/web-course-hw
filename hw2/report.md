# 第二次作业
张仕炫 无97 2019011164
# 一、实现思路  
## 1.丰富前端页面
前端静态页面的实现和作业1类似，都是用bootstrap简化了页面ui的设计和美化，并用到类似网格化卡片的思想实现组件化，在此不赘述。
实现的前端页面效果如图，具有较好的移动端兼容性，可自动适应网页的比例大小缩放
![20220716171353](https://s2.loli.net/2022/07/16/SFNkLYdcHixj7mC.png)
页面的跳转主要是通过vue-router实现的，即route文件夹的index.js
将登录页面作为HomeView.vue,作业1的登陆成功页面为Success.vue。并在index.js里import，然后编写对应的router。
首先把createWebHashHistory改成createWebHistory来删除网站url后面的#,/对应home页面，/success对应success页面,输入url跳转成功
![20220716173218](https://s2.loli.net/2022/07/16/dBDTuvAHQGs4Sxy.png)
对于点击连接按钮跳转到登陆成功页面的实现：
首先要检查确保用户名和密码不为空，直接在自定义的login事件里用alert进行前端报错即可。
使用vue的ref保存变量(使用ref值时需要用.value),并且要在input里用v-model="username"等来绑定属性。然后为表单绑定登陆事件login。
同理断开连接只需绑定logout事件到点击断开连接按钮，然后在logout里写window.location.href = "/";即可

## 2、构建后端并进行前后端通信
我们发现很多页面都需要访问到用户的信息(用户名密码)，所以最好把其存储到全局变量里，通过vuex实现，在store/index.js里
在根组件使用sessionStorage，在页面刷新时将vuex里的信息保存到sessionStorage里，在页面加载时读取sessionStorage里的状态信息，就可以实现不同页面共享一个vuex的全局用户状态信息。
后端保存数据的方式是直接开了个users数组，因为本次作业用户的数据量不大，并没有用到数据库
首次登陆时(即这个用户名从来未登陆过,在后端表现为这个用户名在users数组中不存在)前端会把用户名和密码信息发送给后端(本次作业并没有实现密码验证，所以密码信息在此无效，只是为了可拓展性留出接口)后端会初始化已用流量为0,然后把它加入users数组，并返回用户名，密码，已用流量(0)，然后跳转到/success页面,并在相应位置显示用户名和已用流量。
![20220717153933](https://s2.loli.net/2022/07/17/yNl6UKFiLrndWT8.png)
刷新页面不会造成登出，若在未登出情况下访问登录页面http://localhost:8080/, 会自动跳转到success页面，即在登录页面时必然处于未登录状态
点击断开连接按钮，前端把用户名信息发送给后端，后端将会把该用户名的已用流量随机增加1到10，并保留2位小数。前端再清空vuex的全局状态信息，变成未登录状态，登出，跳转到登录页面。
用同一用户名再次登陆时，后端根据前端发来的用户名在users数组中查找该用户名，然后返回该用户名对应的已用流量，此时即可看到已用流量增加了1到10的随机值。
![20220717154709](https://s2.loli.net/2022/07/17/nTzBhadg5qroI6v.png)
## 2、构建后端并进行前后端通信
# 二、遇到的问题
## 1.丰富前端页面
1.登录页面比成功页面的元素更多，一开始布局的大小比例关系总是调不对
2.在实现链接平时不显示下划线，鼠标移动到上面才显示出下划线时遇到了困难
3.在实现头部的div时校园网的logo超出了div的范围，不知道如何实现定位

## 2、构建后端并进行前后端通信
1.执行完自定义的登陆事件后还会执行表单的默认事件，希望阻止它
2.登录页面登录时vuex的state数据更新正常，但跳转到success页面后vuex数据不存在了
3.在实现处于登录状态访问登录界面会重定向到成功登录界面时遇到了困难，若直接重定向总是报错Maximum call stack size exceeded 
# 三、解决办法
## 1.丰富前端页面
1.想到用bootstrap的网格卡片(card group)思想，先在宏观上把整个页面分成4部分(4个网格)，然后在各自的网格内编写对应的组件，就不用考虑大小比例关系了，因为网格会自动调整,这种组件化思想值得记住
2.查阅资料发现可用伪类a:hover实现
3.可设置position的left为负数
## 2、构建后端并进行前后端通信
1.在js里是用e.preventDefault,但是在vue里有自己的写法: @submit.prevent="login",阻止掉其默认的行为
2.这是因为vuex里的数据是保存在运行内存中的，当页面刷新时，页面会重新加载vue实例，vuex里面的数据就会消失。解决方法是在根组件使用sessionStorage，在页面刷新时将vuex里的信息保存到sessionStorage里，在页面加载时读取sessionStorage里的状态信息。然后断开连接时清空vuex里的状态数据即可
3.最后查阅官方文档，通过导航守卫router.beforeEach来实现，并且在router的index.js中读取了vuex保存的登录状态来判断重定向
# 四、使用说明
vue-cli导入项目后，先运行后端app。
再在前端输入http://localhost:8080/ 为登录界面，输入用户名和任意密码(没实现密码验证),即连接成功，跳转到连接成功的页面，并会显示该用户名的已用流量，已用流量信息在后端保持启动的情况下不丢失，即使多次打开前端页面,多次断开连接又登录也能正确累积显示